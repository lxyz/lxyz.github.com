<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="HanHor Wu" />
    
    <title>HanHor笔记</title>
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link href="/atom.xml" rel="alternate" title="setImpl" type="application/atom+xml" />
    <link rel="stylesheet" href="/css/style.css">
    <link rel="stylesheet" href="/css/github.css">
    <script type="text/javascript" src="/js/highlight.pack.js"></script>
    <script type="text/javascript">
      hljs.initHighlightingOnLoad();
    </script>
  </head>
  <body>
      <div id="main" role="main">
        <header>
          <div id="header">
            <h1><a title="HanHor笔记" class="" href="/">HanHor笔记</a></h1>
            <nav>
              <span><a title="archive"  href="/archive.html">Archive</a></span>
              <span><a title="tags"  href="/tags.html">Tags</a></span>
              <span><a title="about"  href="/about.html">About</a></span>
              <span><a title="blogroll"  href="/links.html">Links</a></span>
              <span><a title="subscribe me"  href="/atom.xml">Feed</a></span>
            </nav>
          </div>
        </header>
        <div id="content">
        <div>
  <ul class="listing">
  
  <article class="content">
    <section class="title">
      <h2><a href="/2012/07/compile-mysql-on-gentoo.html">gentoo编译mysql</a></h2>
    </section>
    <section class="meta">
    <span class="time">
      <time datetime="2012-07-16">2012-07-16</time>
    </span>
    
    <span class="tags">
      
      <a href="/tags.html#gentoo" title="gentoo">#gentoo</a>
      
      <a href="/tags.html#mysql" title="mysql">#mysql</a>
      
    </span>
    
    </section>
    <section class="post">
    <p>gentoo 编译nginx参见:<a href="http://blog.hanhor.com/2012/07/compile-nginx-on-gentoo.html">gentoo编译nginx</a></p>

<p>1.下载mysql源码:</p>

<p>我下载的是mysql-5.5.25a</p>

<pre><code>wget http://cdn.mysql.com/Downloads/MySQL-5.5/mysql-5.5.25a.tar.gz
</code></pre>

<p>2.创建mysql用户:</p>

<p>我创建mysql的用户名是mysql,用户组是mysql,命令如下:</p>

<pre><code>groupadd mysql
useradd -g mysql -s /sbin/nologin -M mysql
</code></pre>

<p>3.安装cmake</p>

<pre><code>emerge cmake
</code></pre>

<p>4.编译mysql:</p>

<pre><code>tar mysql-5.5.25a.tar.gz
cd mysql-5.5.25a
cmake . \
-DCMAKE_INSTALL_PREFIX=/opt/mysql \
-DINSTALL_DATADIR=/opt/mysql/data \
-DSYSCONFDIR=/opt/mysql/etc \
-DWITH_MYISAM_STORAGE_ENGINE=1 \
-DWITH_INNOBASE_STORAGE_ENGINE=1 \
-DWITH_ARCHIVE_STORAGE_ENGINE=1 \
-DWITH_BLACKHOLE_STORAGE_ENGINE=1 \
-DENABLED_LOCAL_INFILE=1 \
-DDEFAULT_CHARSET=utf8 \
-DDEFAULT_COLLATION=utf8_general_ci \
-DEXTRA_CHARSETS=all \
-DMYSQL_TCP_PORT=3306 \
-DMYSQL_UNIX_ADDR=/tmp/mysqld.sock \
-DMYSQL_USER=mysql \
-DWITH_DEBUG=0
</code></pre>

<p>安装目录是/opt/mysql,没指定data目录则data目录为安装目录下的data文件夹.其他的参数可根据需要自己添加.关于cmake可以参考:<a href="http://who0168.blog.51cto.com/253401/469898">MySQL5.5编译工具configure向cmake过渡指南</a> .</p>

<p>接着:</p>

<pre><code>make
</code></pre>

<p>make时可以制定 -j参数,来提高编译的效率,参见<a href="http://hi.baidu.com/qshen/blog/item/4a06a41ec9ad6c1440341773.html">make(gmake,gnumake)的-j参数，优化多核、多线程的编译过程</a>.</p>

<p>make完成之后执行:</p>

<pre><code>make install
</code></pre>

<p>5.配置mysql:</p>

<pre><code>cd /opt/mysql
cp support-files/my-medium.cnf /opt/mysql/etc/my.cnf
</code></pre>

<p>安装初始数据库:</p>

<pre><code>script/mysql_install_db --user=mysql --basedir=/opt/mysql
</code></pre>

<p>注意,这里的mysql_install_db 在安装mysql目录下的script/目录中.</p>

<p>执行完成之后会提示如下信息:</p>

<pre><code>Installing MySQL system tables...
OK
Filling help tables...
OK

To start mysqld at boot time you have to copy
support-files/mysql.server to the right place for your system

PLEASE REMEMBER TO SET A PASSWORD FOR THE MySQL root USER !
To do so, start the server, then issue the following commands:

/opt/mysql/bin/mysqladmin -u root password 'new-password'
/opt/mysql/bin/mysqladmin -u root -h hhw-server password 'new-password'

Alternatively you can run:
/opt/mysql/bin/mysql_secure_installation

which will also give you the option of removing the test
databases and anonymous user created by default.  This is
strongly recommended for production servers.

See the manual for more instructions.

You can start the MySQL daemon with:
cd /opt/mysql ; /opt/mysql/bin/mysqld_safe &amp;

You can test the MySQL daemon with mysql-test-run.pl
cd /opt/mysql/mysql-test ; perl mysql-test-run.pl

Please report any problems with the /opt/mysql/scripts/mysqlbug script!
</code></pre>

<p>按照上面输出的提示信息操作就好了.</p>

<p>接着:</p>

<pre><code>cp support-files/mysql.server /etc/init.d/mysql
export PATH=/opt/mysql/bin:$PATH
rc-update add mysql default
</code></pre>

<p>现在启动mysql看看:</p>

<pre><code>/etc/init.d/mysql start
</code></pre>

<p>发现安装已经完成了.</p>

<p>参考 <a href="http://blog.csdn.net/htttw/article/details/6802130">Ubuntu 安装MySQL</a> .</p>

    </section>
    </article>
  
  <article class="content">
    <section class="title">
      <h2><a href="/2012/07/compile-nginx-on-gentoo.html">gentoo编译nginx</a></h2>
    </section>
    <section class="meta">
    <span class="time">
      <time datetime="2012-07-15">2012-07-15</time>
    </span>
    
    <span class="tags">
      
      <a href="/tags.html#gentoo" title="gentoo">#gentoo</a>
      
      <a href="/tags.html#nginx" title="nginx">#nginx</a>
      
    </span>
    
    </section>
    <section class="post">
    <p>  今天搞了个gentoo玩玩.内存开销确实小啊.先在上面编译个nginx.步骤如下:</p>

<p>1.下载nginx:</p>

<p>我下载的是nginx 1.2.2 stable</p>

<pre><code>wget http://nginx.org/download/nginx-1.2.2.tar.gz
</code></pre>

<p>2.创建nginx用户和组:</p>

<p>我创建nginx的用户名是www,用户组是www,命令如下:</p>

<pre><code>groupadd www
useradd -g www -s /sbin/nologin -M www
</code></pre>

<p>3.编译nginx:</p>

<pre><code>tar zxvf nginx-1.2.2.tar.gz
cd nginx-1.2.2
./configure --user=www --group=www --prefix=/opt/nginx --with-http_stub_status_module --with-http_ssl_module --with-http_realip_module --with-http_stub_status_module --with-http_gzip_static_module
</code></pre>

<p>安装目录是/opt/nginx,其他的模块可根据需要自己添加.具体可以参见<a href="http://wiki.nginx.org/Modules">nginx官方wiki</a> .</p>

<p>4.设置开机启动,环境变量等:</p>

<p>将<a href="https://github.com/HorX/gentoo_server">nginx.init</a>这个文件下载下来,copy到/etc/init.d/nginx</p>

<pre><code>cp nginx.init /etc/init.d/nginx
</code></pre>

<p>然后执行:</p>

<pre><code>export PATH=/opt/nginx/sbin:$PATH
</code></pre>

<p>接着:</p>

<pre><code>rc-update add nginx default
</code></pre>

<p>现在启动nginx看看:</p>

<pre><code>/etc/init.d/nginx start
</code></pre>

<p>如果提示错误:</p>

<pre><code>/etc/init.d/nginx: line 22: /lib/lsb/init-functions: No such file or directory
</code></pre>

<p>将rc.status和init-functions<a href="https://github.com/HorX/gentoo_server">两个文件</a>分别copy/etc/ 和/etc/lsb/目录(参考:<a href="http://www.gentoo-wiki.info/Rivendell">gentoo wiki</a>):</p>

<pre><code>cp rc.status /etc/rc.status
mkdir /lib/lsb/
cp init-functions /lib/lsb/init-functions
</code></pre>

<p>然后再启动nginx,就没什么问题了.</p>

<p>接下来就是配置nginx,这个可以参考nginx官方的wiki.</p>

<p>文中所涉及到的要下载的文件:</p>

<pre><code>nginx.init
rc.status
init-functions
</code></pre>

<p>见 <a href="https://github.com/HorX/gentoo_server">https://github.com/HorX/gentoo_server</a> .</p>

    </section>
    </article>
  
  </ul>
  <div class="center">
  <a href="/archive.html" class="circle-wrapper">
  <div class="circle">&nbsp;</div>
  <div class="circle">&nbsp;</div>
  <div class="circle">&nbsp;</div>
  </a>
  </div>
</div>


        </div>
        <footer>&copy; 2010 ~ 2012 <a href ="http://blog.hanhor.com">HanHor的笔记</a> | <a href="http://www.hanhor.com" target="_blank" title="HanHor.com">HanHor.com</a></footer>
      </div> <!-- main -->
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-33056678-1']);
    _gaq.push(['_trackPageview']);
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  </body>
</html>
